Hereâ€™s a structured guide for setting up a Kubernetes cluster with *one master node* and *one worker node*:  

---

# *Kubernetes Cluster Setup (1 Master, 1 Worker)*
This guide sets up a Kubernetes cluster with:  
* *1 Master Node* (Control plane)  
* *1 Worker Node* (Joins the cluster)  

---

## *ğŸ”¹ Step 1: Prepare Both Machines (Master & Worker)*
Run these commands on *both* the master and worker nodes.

### 1ï¸âƒ£ Update and Upgrade the System*
bash
sudo apt update
sudo apt upgrade -y

ğŸ‘‰ Example: Refreshing phone apps before installing new ones.

---

### *2ï¸âƒ£ Disable Swap (Required for Kubernetes)*
bash
sudo swapoff -a
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab

ğŸ‘‰ Example: Removing a backup battery so Kubernetes always runs on the main battery.

---

### *3ï¸âƒ£ Enable Required Kernel Modules*
bash
sudo tee /etc/modules-load.d/containerd.conf <<EOF
overlay
br_netfilter
EOF

bash
sudo modprobe overlay
sudo modprobe br_netfilter

ğŸ‘‰ Example: Turning on Wi-Fi and Bluetooth before using the internet.

---

### *4ï¸âƒ£ Configure Network Settings*
bash
sudo tee /etc/sysctl.d/kubernetes.conf <<EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF

bash
sudo sysctl --system

ğŸ‘‰ Example: Setting up traffic rules for a city.

---

### *5ï¸âƒ£ Add Kubernetes Package Repository*
bash
sudo apt-get install -y apt-transport-https ca-certificates curl gpg

bash
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

bash
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

bash
sudo apt-get update

ğŸ‘‰ Example: Adding a new app store before downloading an app.

---

### *6ï¸âƒ£ Install Kubernetes Components*
bash
sudo apt-get install -y kubelet kubeadm kubectl

bash
sudo apt-mark hold kubelet kubeadm kubectl

ğŸ‘‰ Example: Installing a messaging app (WhatsApp) before sending messages.

---

## *ğŸ”¹ Step 2: Configure the Master Node*
Run these commands *only on the master node*.

### *7ï¸âƒ£ Initialize the Kubernetes Cluster*
bash
sudo kubeadm init

ğŸ‘‰ Example: Setting up a Wi-Fi router before connecting devices.

ğŸ“Œ After running this command, Kubernetes will generate a *join command* like this:
bash
kubeadm join <MASTER_IP>:6443 --token <TOKEN> \
    --discovery-token-ca-cert-hash sha256:<HASH>

ğŸ‘‰ Copy and save this commandâ€”you will need it for the worker node.

---

### *8ï¸âƒ£ Set Up kubectl for the Master Node*
bash
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

ğŸ‘‰ Example: Saving Wi-Fi credentials so you donâ€™t have to enter them every time.

---

### *9ï¸âƒ£ Install a Network Plugin (Calico)*
bash
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

ğŸ‘‰ Example: Installing Google Maps so devices know where to send data.

---

## *ğŸ”¹ Step 3: Configure the Worker Node*
Run these commands *only on the worker node*.

### *ğŸ”Ÿ Join the Worker Node to the Cluster*
Run the *join command* generated in Step 7 on the worker node:
bash
kubeadm join <MASTER_IP>:6443 --token <TOKEN> \
    --discovery-token-ca-cert-hash sha256:<HASH>

ğŸ‘‰ Example: Connecting a new laptop to the same Wi-Fi network.

---

## *ğŸ”¹ Step 4: Final Steps*
Run these commands *only on the master node*.

### *1ï¸âƒ£1ï¸âƒ£ Verify the Cluster*
Check if the worker node has joined:
bash
kubectl get nodes

âœ”ï¸ Expected Output:

NAME         STATUS   ROLES           AGE     VERSION
master-node  Ready    control-plane   5m      v1.28.0
worker-node  Ready    <none>          2m      v1.28.0

ğŸ‘‰ This confirms that:
* The *master node is running*  
* The *worker node is connected*  
* *Kubernetes is fully functional* ğŸ‰  

---

### *1ï¸âƒ£2ï¸âƒ£ Ensure Kubernetes Starts on Reboot*
Run this on *both the master and worker nodes*:
bash
sudo systemctl enable --now kubelet

ğŸ‘‰ Example: Setting your Wi-Fi to auto-connect when you turn on your phone.

---

## *ğŸ¯ Final Output*
* âœ… *Master node* controls the cluster.  
* âœ… *Worker node* joins and runs applications.  
* âœ… *Pods can talk to each other* via Calico networking.  
* âœ… *Cluster is fully functional!* ğŸ‰  

Now you can deploy applications on Kubernetes! ğŸš€

kubernetes installation notes (syed_k8s_21-02-2025)